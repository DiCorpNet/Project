$(document).ready(()=>{$(".conversation-list").scrollTop($(".conversation-list")[0].scrollHeight);$("#chattext").focus()});var ws="",message_list=document.querySelector(".conversation-list");$(".chat-send").on("click",(a)=>{a.preventDefault();a=$("#chattext");ws.send(JSON.stringify({type:"send",message:a.val(),username:user_in}));a.val("");$("#chattext").focus()});
$("#search-user").on("keyup",function(a){a=$(this).val();var b=document.getElementById("user-search-list");""!=a&&3<a.length&&($(".search-to").fadeOut(),b.innerHTML="",axios.get("/message/search-user/"+a+"/").then((a)=>{a=a.data;if(0!=a.length){b.innerHTML="";for(i=0;a.length>i;i++)b.innerHTML+='<li class="nav-item" value="'+a[i].room+'">       <div class="row">           <div class="col-2">               <img class="img-fluid rounded-circle" src="'+a[i].image+'" alt="">           </div>           <div class="col-10" value="'+
a[i].username+'">'+a[i].username+"</div>        </div></li>";$(".search-to").fadeIn()}}))});$(".close-search").on("click",(a)=>{$(".search-to").fadeOut()});$("#user-search-list").on("click",".nav-item",(a)=>{var b=a.currentTarget.getAttribute("value");a=a.currentTarget.lastElementChild.lastElementChild.getAttribute("value");create_room(b,a);$(".search-to").fadeOut()});
$(".user-r").on("click",".text-body",(a)=>{a.preventDefault();a=a.currentTarget.getAttribute("value");if(ws){if(ws.url){var b=ws.url.split("/");a!=b[4]&&(ws.close(),connectWS(a))}}else connectWS(a);$(".conversation-list").animate({scrollTop:2E7},"slow")});
function connectWS(a){ws=new WebSocket("ws://"+window.location.host+"/ws/"+a+"/");ws.onopen=(a)=>{ws.send(JSON.stringify({type:"open"}));$(".conversation-list").animate({scrollTop:2E7},"slow");$("#after_message").html("");console.log("Connection Established")};ws.onmessage=(a)=>{a=JSON.parse(a.data);switch(a.type){case "open":OpenRoomData(a.data);OpenUserRoom(a.userTo);break;default:GetMessage(a)}$(".conversation-list").animate({scrollTop:2E7},"slow")};ws.onerror=(a)=>{message_list.innerHTML+='<div class="alert alert-info">\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438\u043b\u0438 \u0432\u043e\u0439\u0442\u0438 \u043f\u043e\u0437\u0436\u0435.</div>';
console.log(a)};ws.onclose=(a)=>{console.log("Connect Close")}}
function GetMessage(a){message_list.innerHTML=a.user==user_in?message_list.innerHTML+('<li class="clearfix odd" id="'+a.id+'"> <div class="chat-avatar"><img src="'+a.user_image+'" alt="dominic" class="rounded" /><i>'+a.created+'</i></div><div class="conversation-text"><div class="ctext-wrap"><i>'+a.user_in+"</i><p>"+a.message+'</p> </div></div><div class="conversation-actions dropdown"><button class="btn btn-sm btn-link" data-bs-toggle="dropdown"aria-expanded="false"><i class="uil uil-ellipsis-v"></i></button><div class="dropdown-menu"><a class="dropdown-item" href="#">Copy Message</a><a class="dropdown-item" href="#">Edit</a> <a class="dropdown-item" href="#">Delete</a></div></div></li>'):message_list.innerHTML+
('<li class="clearfix" id="'+a.id+'"> <div class="chat-avatar"><img src="'+a.user_image+'" alt="dominic" class="rounded" /><i>'+a.created+'</i></div><div class="conversation-text"><div class="ctext-wrap"><i>'+a.user_in+"</i><p>"+a.message+'</p> </div></div><div class="conversation-actions dropdown"><button class="btn btn-sm btn-link" data-bs-toggle="dropdown"aria-expanded="false"><i class="uil uil-ellipsis-v"></i></button><div class="dropdown-menu"><a class="dropdown-item" href="#">Copy Message</a><a class="dropdown-item" href="#">Edit</a> <a class="dropdown-item" href="#">Delete</a></div></div></li>')}
function OpenUserRoom(a){document.getElementById("u-info").innerHTML='<div class="card">\n                                    <div class="card-body">\n                                        <div class="dropdown float-end">\n                                            <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">\n                                                <i class="mdi mdi-dots-horizontal"></i>\n                                            </a>\n                                            <div class="dropdown-menu dropdown-menu-end">\n                                                \x3c!-- item--\x3e\n                                                <a href="javascript:void(0);" class="dropdown-item">View full</a>\n                                                \x3c!-- item--\x3e\n                                                <a href="javascript:void(0);" class="dropdown-item">Edit Contact Info</a>\n                                                \x3c!-- item--\x3e\n                                                <a href="javascript:void(0);" class="dropdown-item">Remove</a>\n                                            </div>\n                                        </div>\n\n                                        <div class="mt-3 text-center">\n                                            <img src="'+
a[0].image+'" alt="shreyu"\n                                                class="img-thumbnail avatar-lg rounded-circle" />\n                                            <h4>'+a[0].username+'</h4>\n                                            <button class="btn btn-primary btn-sm mt-1"><i class=\'uil uil-envelope-add me-1\'></i>Send Email</button>\n                                            <p class="text-muted mt-2 font-14">Last Interacted: <strong>Few hours back</strong></p>\n                                        </div>\n\n                                        <div class="mt-3">\n                                            <hr class="" />\n\n                                            <p class="mt-4 mb-1"><strong><i class=\'uil uil-at\'></i> Email:</strong></p>\n                                            <p>'+
a[0].email+"</p>\n\n                                            <p class=\"mt-3 mb-1\"><strong><i class='uil uil-location'></i> Location:</strong></p>\n                                            <p>"+a[0].country+"</p>\n\n                                            <p class=\"mt-3 mb-1\"><strong><i class='uil uil-globe'></i> Languages:</strong></p>\n                                            <p>"+a[0].location+'</p>\n\n                                            <p class="mt-3 mb-2"><strong><i class=\'uil uil-users-alt\'></i> Groups:</strong></p>\n                                            <p>\n                                                <span class="badge badge-success-lighten p-1 font-14">Work</span>\n                                                <span class="badge badge-primary-lighten p-1 font-14">Friends</span>\n                                            </p>\n                                        </div>\n                                    </div> \x3c!-- end card-body --\x3e\n                                </div>'}
function OpenRoomData(a){for(i=a.length-1;0<=i;i--)message_list.innerHTML=a[i].user==a[i].user_in?message_list.innerHTML+('<li class="clearfix odd" id="'+a[i].id+'"> <div class="chat-avatar"><img src="'+a[i].user_image+'" alt="dominic" class="rounded" /><i>'+a[i].created+'</i></div><div class="conversation-text"><div class="ctext-wrap"><i>'+a[i].user_in+"</i><p>"+a[i].text+'</p> </div></div><div class="conversation-actions dropdown"><button class="btn btn-sm btn-link" data-bs-toggle="dropdown"aria-expanded="false"><i class="uil uil-ellipsis-v"></i></button><div class="dropdown-menu"><a class="dropdown-item" href="#">Copy Message</a><a class="dropdown-item" href="#">Edit</a> <a class="dropdown-item" href="#">Delete</a></div></div></li>'):
message_list.innerHTML+('<li class="clearfix" id="'+a[i].id+'"> <div class="chat-avatar"><img src="'+a[i].user_image+'" alt="dominic" class="rounded" /><i>'+a[i].created+'</i></div><div class="conversation-text"><div class="ctext-wrap"><i>'+a[i].user+"</i><p>"+a[i].text+'</p> </div></div><div class="conversation-actions dropdown"><button class="btn btn-sm btn-link" data-bs-toggle="dropdown"aria-expanded="false"><i class="uil uil-ellipsis-v"></i></button><div class="dropdown-menu"><a class="dropdown-item" href="#">Copy Message</a><a class="dropdown-item" href="#">Edit</a> <a class="dropdown-item" href="#">Delete</a></div></div></li>');
$("#message-input").fadeIn()}function create_room(a,b){axios.post("/message/create-room/",{room:a,userto:b},{headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRFToken":csrftoken}}).then((a)=>{console.log(a.data)})};
